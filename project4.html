<!DOCTYPE html>
<html lang="en">https://github.com/KalleJosefsson/KalleJosefsson.github.io/blob/main/project4.html
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 4: Mosaics</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 50px;
        }
        h1 {
            font-size: 2.5em;
            color: #4CAF50;
        }
        h2, h3, h4, h5, h6 {
            color: #4CAF50;
            margin-top: 40px;
        }
        p {
            font-size: 1.2em;
            line-height: 1.6em;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
        }
        section {
            margin-bottom: 40px;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            font-size: 0.8em;
            color: #777;
        }
        .screenshot {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .image-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        .image-pair {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        .image-pair img {
            margin-bottom: 10px;
            border-radius: 10px;
        }
        .caption {
            font-style: italic;
        }
        .equation-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header>
        <h1>Project 4: Mosaics</h1>
    </header>

    <p>
        In order to create mosaics, we need to go over some theory, which is done below step for step:
    </p>

    <div class="equation-container">
        <h2>1. Homography Transformation</h2>
        <p>Points \( p = (x, y) \) in one image are mapped to points \( p' = (x', y') \) in another image:</p>
        <p>
            \[
            s \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix} =
            \mathbf{H} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}
            \]
        </p>
        <p>where \( \mathbf{H} \) is the \( 3 \times 3 \) homography matrix and \( s \) is a scale factor.</p>
    </div>

    <div class="equation-container">
        <h2>2. Structure of Homography Matrix (note the scaling factor h_{33} = 1)\( \mathbf{H} \)</h2>
        <p>
            \[
            \mathbf{H} =
            \begin{bmatrix}
            h_{11} & h_{12} & h_{13} \\
            h_{21} & h_{22} & h_{23} \\
            h_{31} & h_{32} & 1
            \end{bmatrix}
            \]
        </p>
    </div>

    <div class="equation-container">
        <h2>3. Linear System for Estimating \( \mathbf{H} \)</h2>
        <p>Given corresponding points \( (x, y) \) and \( (x', y') \), the following equations are formed:</p>
        <p>
            \[
            \begin{aligned}
            x' &= \frac{h_{11}x + h_{12}y + h_{13}}{h_{31}x + h_{32}y + 1} \\
            y' &= \frac{h_{21}x + h_{22}y + h_{23}}{h_{31}x + h_{32}y + 1}
            \end{aligned}
            \]
        </p>
    </div>

    <div class="equation-container">
        <h2>4. Matrix Formulation for Multiple Points</h2>
        <p>The system can be linearized as:</p>
        <p>
            \[
            \mathbf{A} \mathbf{h} = 0
            \]
        </p>
        <p>where \( \mathbf{A} \) is the design matrix and \( \mathbf{h} \) is a vector of the elements of \( \mathbf{H} \).</p>

        <p>The design matrix \( \mathbf{A} \) for a set of corresponding points \( (x_1, y_1) \) and \( (x_1', y_1') \) is constructed as follows:</p>
        <p>
            \[
            \mathbf{A} = \begin{bmatrix}
            x_1 & y_1 & 1 & 0 & 0 & 0 & -x_1 x_1' & -y_1 x_1' \\
            0 & 0 & 0 & x_1 & y_1 & 1 & -x_1 y_1' & -y_1 y_1'
            \end{bmatrix}
            \]
        </p>
        <p>
            Each pair of corresponding points contributes two rows to the matrix \( \mathbf{A} \). For additional point correspondences, the same pattern repeats, adding new rows to \( \mathbf{A} \). The system is then solved for the vector \( \mathbf{h} \), which contains the elements \( h_{11}, h_{12}, h_{13}, h_{21}, h_{22}, h_{23}, h_{31}, h_{32} \).
        </p>
    </div>

    <div class="equation-container">
        <h2>5. Using More Points and Least Squares</h2>
        <p>
            Although four points are sufficient to estimate the homography matrix \( \mathbf{H} \), using more than four points improves accuracy. By including additional point correspondences, we create an overdetermined system, which can be solved using the least squares method. The least squares approach minimizes the sum of squared errors between the predicted and actual point correspondences, yielding a more robust estimate of \( \mathbf{H} \) that accounts for noise and small variations in the data.
        </p>
    </div>

    <div class="equation-container">
    <h2>6. Image Warping</h2>
    <p>
        Image warping is a key step in creating mosaics, where the goal is to transform one image to align with another using the homography matrix \( \mathbf{H} \). Once we have calculated the homography matrix, we apply it to map the points in the source image to the corresponding points in the target image.
    </p>
    <p>
        To warp an image, for each pixel \( (x', y') \) in the target image, we calculate the corresponding point \( (x, y) \) in the source image using the inverse of the homography transformation:
    </p>
    <p>
        \[
        s \begin{bmatrix} x \\ y \\ 1 \end{bmatrix} =
        \mathbf{H}^{-1} \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix}
        \]
    </p>
    <p>
        Here, \( \mathbf{H}^{-1} \) is the inverse of the homography matrix, and the resulting point \( (x, y) \) is mapped back into the original image.
    </p>

    <p>
        Since the result of this transformation may not lie exactly on an integer pixel, interpolation is used to estimate the pixel intensity at fractional coordinates. Common interpolation methods include nearest-neighbor, bilinear, or bicubic interpolation. This ensures that the warped image retains high-quality visual features.
    </p>

    <p>
        The warping process is repeated for every pixel in the target image, transforming the entire source image to align with the desired view. This enables smooth blending and accurate alignment between images in the final mosaic.
    </p>
</div>

<div class="equation-container">
    <h2>7. Bounding Box of the Warped Image</h2>
    <p>
        After warping an image using the homography matrix \( \mathbf{H} \), the transformed image might not align neatly within the original image boundaries. To ensure that the entire warped image is visible, we compute the bounding box of the transformed image.
    </p>
    <p>
        The bounding box is determined by applying the homography transformation to the four corners of the source image. The corners of an image at coordinates \( (0, 0), (w, 0), (w, h), (0, h) \) (where \( w \) and \( h \) are the width and height of the source image, respectively) are warped using the homography matrix:
    </p>
    <p>
        \[
        \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix} = \mathbf{H} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}
        \]
    </p>
    <p>
        Once the new positions of the four corners are calculated, the minimum and maximum \( x' \) and \( y' \) values provide the extents of the bounding box. This defines the size of the canvas required to display the entire warped image without cropping.
    </p>
    <p>
        It is important to adjust the image translation so that the warped image fits within the computed bounding box. 
    </p>
</div>


<div class="equation-container">
    <h2>8. Image Stitching Using Two Corresponding Points and alpha blending</h2>
    <p>
        Instead of manually determining the overlap and setting an offset, we can use two corresponding points from each image to align the images. These corresponding points are feature points (e.g., corners or key points) that match between the two images. By selecting two pairs of corresponding points, one pair from each image, we can align the images precisely and perform blending in the overlapping region.
    </p>

    <p>
        The stitching process begins by identifying two pairs of corresponding points, \( p_1 \) and \( p_2 \) in the first image, and their corresponding points \( p_1' \) and \( p_2' \) in the second image. These points are then used to calculate a transformation that aligns the two images. By ensuring that both \( p_1 \) aligns with \( p_1' \), and \( p_2 \) aligns with \( p_2' \), we can accurately position the images for stitching.
    </p>

    <p>
        The transformation required to align the two images is typically a combination of translation, scaling, and rotation. Once this transformation is applied, the images are aligned based on the two selected points. We can then perform alpha blending in the overlapping region to create a seamless transition between the two images.
    </p>

    <h3>Stitching Process Using Two Corresponding Points</h3>
    <ol>
        <li>Identify two corresponding points \( p_1, p_1' \) in the first image and their corresponding point in the second image by warping the correspondence points.</li>
        <li>Compute the translation matrix \( T \) that translate the point \ p_1\ in the first image to \ p_1'\ in the second image. This should just be in x but due to COP differing slighlty might be slight translation in y.</li>
        <li>Apply the transformation \( T \) to warp the second image so that the pair of corresponding points are aligned with their counterpart in the first image.</li>
        <li>Blend the overlapping region using alpha blending where weight is based on distance from center of each image, decreasing with distance. This ensures a smooth transition between the two aligned images.</li>
        <li>Concatenate the non-overlapping parts of the images with the blended part to form the final mosaic.</li>
    </ol>

  

   
</div>


    <div class="equation-container">
    <h2>9. Image Rectification</h2>
    <p>
        Image rectification is the process of transforming two or more images to align them onto a common plane. This technique is particularly useful when dealing with stereo images or overlapping images that need to be stitched together. The goal of rectification is to make corresponding points in the images appear at the same vertical position, which simplifies the stitching or matching process.
    </p>
    <p>
        Rectification involves calculating the homography transformations needed to warp both images so that their epipolar lines are aligned. Once the images are rectified, any point in one image will have a corresponding point along the same row in the second image. This ensures that when images are stitched together or matched, the alignment is accurate and seamless which is why we warp images to a cneter image.
    </p>
    <p>
        Below are examples of image rectification applied to two pairs of images. For each pair, we show the original images followed by the rectified versions. The rectified images demonstrate how the homography transformation has changed where the image is projecteed.
    </p>

    <h3>9.1 Pair 1: Original and Rectified Images</h3>
    <div class="image-grid">
        <div class="image-pair">
            <img src="./images4/book_front.jpg" alt="Original Image 1">
            <p class="caption">Figure 1: Original Image of book from the front</p>
        </div>
        <div class="image-pair">
            <img src="./images4/book_up.jpg" alt="Rectified Image 1">
            <p class="caption">Figure 2: Rectified Image seeing the book from above </p>
        </div>
    </div>
    
    <div class="image-grid">
        <div class="image-pair">
            <img src="./images4/wb_left.jpg" alt="Original Image 2">
            <p class="caption">Figure 3: Original Image of Whiteboard from the left </p>
        </div>
        <div class="image-pair">
            <img src="./images4/wb_front.jpg" alt="Rectified Image 2">
            <p class="caption">Figure 4: Rectified Image seing the Whiteboard from the front </p>
        </div>
    </div>

   

    <p>
        These rectified images illustrate how the process transforms the original images, ensuring that they are aligned on the same plane. This alignment is crucial for performing tasks like image stitching or stereo matching, where corresponding points must appear at the same vertical location in both images.
    </p>
</div>

     <div class="equation-container">
    <h2>10. Creating the mosaics</h2>
    <p>
        Below are the three created mosaics which are created by following the above steps and then combining them together. I will show three examples the last two of them with alpha blending with weights being based on distance from image centers. 
        The first example I tried to just use a vertical mask with weights being changen linearly from 0-1 and 1-0 for respective images over the blending area. I thought this would work well
        since we are stitching the images horizontally but since images are of different size the artifacts could be found.
    </p>

    <h3>10.1 Creations of Mosaics</h3>
   
<div class="image-grid">
    <!-- First Row: 3 Images -->
    <div class="image-pair">
        <img src="./images4/a_left.jpg" alt="Original Image 1">
        <p class="caption">Left image of a group room at Mofitt</p>
    </div>
    <div class="image-pair">
        <img src="./images4/a_right.jpg" alt="Rectified Image 1">
        <p class="caption">Right image of a group room </p>
    </div>
    <div class="image-pair">
        <img src="./images4/comp_left.jpg" alt="Original Image 2">
        <p class="caption">Mosaic of a studyroam with vertical seams (Notice artifacts)</p>
    </div>
</div>




<h3>10.2 Pair 2: Original and Rectified Images</h3>
<div class="image-grid">
    <!-- First Row: 3 Images -->
    <div class="image-pair">
        <img src="./images4/b_left.jpg" alt="Original Image 3">
        <p class="caption">Campus left side </p>
    </div>
    <div class="image-pair">
        <img src="./images4/b_middle" alt="Rectified Image 3">
        <p class="caption">Campus right side</p>
    </div>
    <div class="image-pair">
        <img src="./images4/stitched_berkeley.jpg" alt="Original Image 4">
        <p class="caption">Mosaic with alpha blend based on distance to centers </p>
    </div>
</div>



<h3>10.3 Pair 3: Original and Rectified Images</h3>
<div class="image-grid">
    <!-- First Row: 3 Images -->
    <div class="image-pair">
        <img src="./images4/object1_front.jpg" alt="Original Image 5">
        <p class="caption">Figure 9: Original Image of object 1 from the front</p>
    </div>
    <div class="image-pair">
        <img src="./images4/object1_side.jpg" alt="Rectified Image 5">
        <p class="caption">Figure 10: Rectified Image of object 1 from the side</p>
    </div>
    <div class="image-pair">
        <img src="./images4/object2_top.jpg" alt="Original Image 6">
        <p class="caption">Figure 11: Original Image of object 2 from the top</p>
    </div>
</div>




   

    <p>
        These mosaics are my results from 4A and I thought it was really cool that we could do this without any type of machine learning our new data. I can't stress enough how important
        it is to not alter the center of projection when taking the photos or not picking pixel perfect correspondences. I had to do this in order to get good results I noticed after a lot
        of frustration.
    </p>
</div>


 




    <!-- Footer Section -->
    <footer>
        <p>© 2024 Kalle's Portfolio | Project 4: Mosaics</p>
        <p>Contact: <a href="mailto:kj00@berkeley.edu">kj00@berkeley.edu</a></p>
    </footer>
</body>
</html>
