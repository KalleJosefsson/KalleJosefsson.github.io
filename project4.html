<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 4: Mosaics</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 50px;
        }
        h1 {
            font-size: 2.5em;
            color: #4CAF50;
        }
        h2, h3, h4, h5, h6 {
            color: #4CAF50;
            margin-top: 40px;
        }
        p {
            font-size: 1.2em;
            line-height: 1.6em;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
        }
        section {
            margin-bottom: 40px;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            font-size: 0.8em;
            color: #777;
        }
        .screenshot {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .image-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        .image-pair {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        .image-pair img {
            margin-bottom: 10px;
            border-radius: 10px;
        }
        .caption {
            font-style: italic;
        }
        .equation-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header>
        <h1>Project 4: Mosaics</h1>
    </header>

    <p>
        In order to create mosaics, we need to go over some theory, which is done below step for step:
    </p>

    <div class="equation-container">
        <h2>1. Homography Transformation</h2>
        <p>Points \( p = (x, y) \) in one image are mapped to points \( p' = (x', y') \) in another image:</p>
        <p>
            \[
            s \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix} =
            \mathbf{H} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}
            \]
        </p>
        <p>where \( \mathbf{H} \) is the \( 3 \times 3 \) homography matrix and \( s \) is a scale factor.</p>
    </div>

    <div class="equation-container">
        <h2>2. Structure of Homography Matrix (note the scaling factor h_{33} = 1)\( \mathbf{H} \)</h2>
        <p>
            \[
            \mathbf{H} =
            \begin{bmatrix}
            h_{11} & h_{12} & h_{13} \\
            h_{21} & h_{22} & h_{23} \\
            h_{31} & h_{32} & 1
            \end{bmatrix}
            \]
        </p>
    </div>

    <div class="equation-container">
        <h2>3. Linear System for Estimating \( \mathbf{H} \)</h2>
        <p>Given corresponding points \( (x, y) \) and \( (x', y') \), the following equations are formed:</p>
        <p>
            \[
            \begin{aligned}
            x' &= \frac{h_{11}x + h_{12}y + h_{13}}{h_{31}x + h_{32}y + 1} \\
            y' &= \frac{h_{21}x + h_{22}y + h_{23}}{h_{31}x + h_{32}y + 1}
            \end{aligned}
            \]
        </p>
    </div>

    <div class="equation-container">
        <h2>4. Matrix Formulation for Multiple Points</h2>
        <p>The system can be linearized as:</p>
        <p>
            \[
            \mathbf{A} \mathbf{h} = 0
            \]
        </p>
        <p>where \( \mathbf{A} \) is the design matrix and \( \mathbf{h} \) is a vector of the elements of \( \mathbf{H} \).</p>

        <p>The design matrix \( \mathbf{A} \) for a set of corresponding points \( (x_1, y_1) \) and \( (x_1', y_1') \) is constructed as follows:</p>
        <p>
            \[
            \mathbf{A} = \begin{bmatrix}
            x_1 & y_1 & 1 & 0 & 0 & 0 & -x_1 x_1' & -y_1 x_1' \\
            0 & 0 & 0 & x_1 & y_1 & 1 & -x_1 y_1' & -y_1 y_1'
            \end{bmatrix}
            \]
        </p>
        <p>
            Each pair of corresponding points contributes two rows to the matrix \( \mathbf{A} \). For additional point correspondences, the same pattern repeats, adding new rows to \( \mathbf{A} \). The system is then solved for the vector \( \mathbf{h} \), which contains the elements \( h_{11}, h_{12}, h_{13}, h_{21}, h_{22}, h_{23}, h_{31}, h_{32} \).
        </p>
    </div>

    <div class="equation-container">
        <h2>5. Using More Points and Least Squares</h2>
        <p>
            Although four points are sufficient to estimate the homography matrix \( \mathbf{H} \), using more than four points improves accuracy. By including additional point correspondences, we create an overdetermined system, which can be solved using the least squares method. The least squares approach minimizes the sum of squared errors between the predicted and actual point correspondences, yielding a more robust estimate of \( \mathbf{H} \) that accounts for noise and small variations in the data.
        </p>
    </div>

    <div class="equation-container">
    <h2>6. Image Warping</h2>
    <p>
        Image warping is a key step in creating mosaics, where the goal is to transform one image to align with another using the homography matrix \( \mathbf{H} \). Once we have calculated the homography matrix, we apply it to map the points in the source image to the corresponding points in the target image.
    </p>
    <p>
        To warp an image, for each pixel \( (x', y') \) in the target image, we calculate the corresponding point \( (x, y) \) in the source image using the inverse of the homography transformation:
    </p>
    <p>
        \[
        s \begin{bmatrix} x \\ y \\ 1 \end{bmatrix} =
        \mathbf{H}^{-1} \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix}
        \]
    </p>
    <p>
        Here, \( \mathbf{H}^{-1} \) is the inverse of the homography matrix, and the resulting point \( (x, y) \) is mapped back into the original image.
    </p>

    <p>
        Since the result of this transformation may not lie exactly on an integer pixel, interpolation is used to estimate the pixel intensity at fractional coordinates. Common interpolation methods include nearest-neighbor, bilinear, or bicubic interpolation. This ensures that the warped image retains high-quality visual features.
    </p>

    <p>
        The warping process is repeated for every pixel in the target image, transforming the entire source image to align with the desired view. This enables smooth blending and accurate alignment between images in the final mosaic.
    </p>
</div>

<div class="equation-container">
    <h2>7. Bounding Box of the Warped Image</h2>
    <p>
        After warping an image using the homography matrix \( \mathbf{H} \), the transformed image might not align neatly within the original image boundaries. To ensure that the entire warped image is visible, we compute the bounding box of the transformed image.
    </p>
    <p>
        The bounding box is determined by applying the homography transformation to the four corners of the source image. The corners of an image at coordinates \( (0, 0), (w, 0), (w, h), (0, h) \) (where \( w \) and \( h \) are the width and height of the source image, respectively) are warped using the homography matrix:
    </p>
    <p>
        \[
        \begin{bmatrix} x' \\ y' \\ 1 \end{bmatrix} = \mathbf{H} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}
        \]
    </p>
    <p>
        Once the new positions of the four corners are calculated, the minimum and maximum \( x' \) and \( y' \) values provide the extents of the bounding box. This defines the size of the canvas required to display the entire warped image without cropping.
    </p>
    <p>
        It is important to adjust the image translation so that the warped image fits within the computed bounding box. This may involve shifting the image if negative coordinates are present.
    </p>
</div>

<div class="equation-container">
    <h2>8. Alpha Blending Using Linear Gradient</h2>
    <p>
        When merging two overlapping images into a mosaic, alpha blending is used to create a smooth transition in the overlapping region. In this approach, the blending factor changes linearly across the overlap, ensuring that the transition from one image to the other is gradual and seamless.
    </p>
    <p>
        The blending process begins by identifying the overlap between the two images. Suppose the overlap starts at a specific column in the first image and extends across both images. A horizontal gradient mask is created to determine the contribution of each image at every pixel in the overlapping region.
    </p>
    <p>
        For each pixel in the overlapping region, the alpha value is assigned based on a linear gradient from 1 to 0. Pixels closer to the beginning of the overlap are weighted more heavily toward the first image, while pixels closer to the end of the overlap are weighted more toward the second image. The alpha blending formula for each pixel in the overlap is:
    </p>
    <p>
        \[
        I_{\text{final}}(x, y) = \alpha(x) I_1(x, y) + (1 - \alpha(x)) I_2(x, y)
        \]
    </p>
    <p>
        Here, \( \alpha(x) \) is the blending factor that linearly decreases from 1 to 0 across the width of the overlap, \( I_1(x, y) \) is the pixel intensity from the first image, and \( I_2(x, y) \) is the pixel intensity from the second image. The closer a pixel is to the start of the overlap, the more it contributes from the first image, and vice versa.
    </p>
    <p>
        This approach is effective for cases where the overlap between images occurs in a horizontal band. By applying a linear gradient across the width of the overlap, the transition between the images is smooth and natural. The non-overlapping regions of the images are concatenated directly to form the final mosaic.
    </p>
</div>

    <div class="equation-container">
    <h2>9. Image Stitching and Offset Handling</h2>
    <p>
        After warping and blending the images, the final step in creating a mosaic is stitching the images together. Image stitching involves aligning the two images by overlapping their corresponding regions and ensuring that they are combined seamlessly.
    </p>
    <p>
        In some cases, an offset may be required during the stitching process. This offset occurs because the center of projection might have shifted slightly when the photographs were taken. Ideally, if the camera position and orientation are kept constant, the homography transformation alone would perfectly align the images. However, any slight changes in the center of projection or camera movement can lead to misalignment, making an additional offset necessary.
    </p>
    <p>
        The offset represents a horizontal shift in the starting point of the overlap between the two images. In your alpha blending function, the parameter <code>overlap_start</code> specifies the point where the overlap begins in the first image. This parameter accounts for any misalignment caused by changes in the center of projection, ensuring that the images are properly aligned before blending.
    </p>
    <p>
        By manually adjusting the overlap start, we can account for these small changes in the capture setup and ensure that the images are stitched together correctly. Without this adjustment, the images might not align as expected, leading to visible seams or distortions in the final mosaic.
    </p>
    <p>
        Once the images are aligned and blended using the alpha blending technique, the final step is concatenating the non-overlapping parts of the images along with the blended region to form a complete mosaic. The stitching process ensures that the images are seamlessly combined into a unified scene.
    </p>
</div>




    <!-- Footer Section -->
    <footer>
        <p>© 2024 Kalle's Portfolio | Project 4: Mosaics</p>
        <p>Contact: <a href="mailto:kj00@berkeley.edu">kj00@berkeley.edu</a></p>
    </footer>
</body>
</html>
